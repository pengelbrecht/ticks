<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tick Board</title>
    <link rel="icon" type="image/svg+xml" href="static/favicon.svg">
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <div id="app">
        <header>
            <div class="header-left">
                <h1>Tick Board</h1>
                <span id="repo-name" class="repo-name"></span>
            </div>
            <div class="header-center">
                <div class="search-wrapper">
                    <input type="text" id="search-input" class="search-input" placeholder="Search by ID or title..." oninput="handleSearchInput()">
                    <button id="search-clear" class="search-clear hidden" onclick="clearSearch()" aria-label="Clear search">&times;</button>
                </div>
                <select id="epic-filter" class="epic-filter" onchange="handleEpicFilterChange()">
                    <option value="">All Ticks</option>
                </select>
            </div>
            <div class="header-right">
                <button id="activity-btn" class="header-btn header-btn-activity" onclick="toggleActivityDropdown()" title="Recent activity">
                    <span class="activity-icon-bell">⚡</span>
                    <span id="activity-badge" class="activity-badge hidden">0</span>
                </button>
                <button class="header-btn" onclick="openCreateModal()" title="Create new tick">+</button>
                <button id="cloud-home-btn" class="header-btn header-btn-cloud hidden" onclick="goToCloudHome()" title="Switch board">⌂</button>
            </div>
        </header>
        <main id="board" class="kanban-board">
            <div class="kanban-column" data-column="blocked">
                <div class="column-header">
                    <h2>Blocked</h2>
                    <span class="count-badge">0</span>
                </div>
                <div class="column-content">
                    <p class="empty-state">No blocked items</p>
                </div>
            </div>
            <div class="kanban-column" data-column="ready">
                <div class="column-header">
                    <h2>Agent Queue</h2>
                    <span class="count-badge">0</span>
                </div>
                <div class="column-content">
                    <p class="empty-state">No items ready</p>
                </div>
            </div>
            <div class="kanban-column" data-column="agent">
                <div class="column-header">
                    <h2>In Progress</h2>
                    <span class="count-badge">0</span>
                </div>
                <div class="column-content">
                    <p class="empty-state">No items in progress</p>
                </div>
            </div>
            <div class="kanban-column" data-column="human">
                <div class="column-header">
                    <h2>Needs Human</h2>
                    <span class="count-badge">0</span>
                </div>
                <div class="column-content">
                    <p class="empty-state">No items awaiting human</p>
                </div>
            </div>
            <div class="kanban-column" data-column="done">
                <div class="column-header">
                    <h2>Done</h2>
                    <span class="count-badge">0</span>
                </div>
                <div class="column-content">
                    <p class="empty-state">No completed items</p>
                </div>
            </div>
        </main>
        <!-- Activity Dropdown -->
        <div id="activity-dropdown" class="activity-dropdown hidden">
            <div class="activity-dropdown-header">
                <span>Recent Activity</span>
            </div>
            <div id="activity-list" class="activity-list">
                <p class="activity-empty">Loading...</p>
            </div>
        </div>
        <!-- Tick Detail Panel Overlay -->
        <div id="detail-overlay" class="detail-overlay hidden" onclick="closeTickDetail()"></div>
        <!-- Tick Detail Panel -->
        <aside id="detail-panel" class="detail-panel hidden">
            <div class="detail-header">
                <div class="detail-header-left">
                    <span id="detail-id" class="detail-id"></span>
                    <span id="detail-status" class="detail-status"></span>
                </div>
                <button class="detail-close" onclick="closeTickDetail()" aria-label="Close panel">&times;</button>
            </div>
            <div class="detail-content">
                <h2 id="detail-title" class="detail-title"></h2>

                <!-- Core Fields Section -->
                <section class="detail-section">
                    <h3 class="detail-section-title">Details</h3>
                    <div class="detail-fields">
                        <div class="detail-field">
                            <span class="detail-label">Type</span>
                            <span id="detail-type" class="detail-value"></span>
                            <select id="detail-type-edit" class="detail-select hidden" onchange="updateTickField('type', this.value)">
                                <option value="task">Task</option>
                                <option value="epic">Epic</option>
                                <option value="bug">Bug</option>
                                <option value="feature">Feature</option>
                                <option value="chore">Chore</option>
                            </select>
                        </div>
                        <div class="detail-field">
                            <span class="detail-label">Priority</span>
                            <span id="detail-priority" class="detail-value"></span>
                            <select id="detail-priority-edit" class="detail-select hidden" onchange="updateTickField('priority', parseInt(this.value))">
                                <option value="0">P0 - Critical</option>
                                <option value="1">P1 - High</option>
                                <option value="2">P2 - Medium</option>
                                <option value="3">P3 - Low</option>
                                <option value="4">P4 - Backlog</option>
                            </select>
                        </div>
                        <div class="detail-field">
                            <span class="detail-label">Owner</span>
                            <span id="detail-owner" class="detail-value"></span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-label">Created</span>
                            <span id="detail-created" class="detail-value"></span>
                        </div>
                        <div class="detail-field" id="detail-parent-field">
                            <span class="detail-label">Parent</span>
                            <span id="detail-parent" class="detail-value"></span>
                            <select id="detail-parent-edit" class="detail-select hidden" onchange="updateTickField('parent', this.value)">
                                <option value="">None</option>
                            </select>
                        </div>
                        <div class="detail-field" id="detail-requires-field">
                            <span class="detail-label">Workflow</span>
                            <span id="detail-requires" class="detail-value"></span>
                            <select id="detail-requires-edit" class="detail-select hidden" onchange="updateTickField('requires', this.value)">
                                <option value="">None</option>
                                <option value="approval">Requires Approval</option>
                                <option value="review">Requires Review</option>
                                <option value="content">Requires Content</option>
                            </select>
                        </div>
                        <div class="detail-field" id="detail-labels-field" style="display: none;">
                            <span class="detail-label">Labels</span>
                            <span id="detail-labels" class="detail-value"></span>
                        </div>
                    </div>
                </section>

                <!-- Description Section -->
                <section id="detail-description-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Description</h3>
                    <p id="detail-description" class="detail-description"></p>
                </section>

                <!-- Acceptance Criteria Section -->
                <section id="detail-ac-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Acceptance Criteria</h3>
                    <p id="detail-ac" class="detail-description"></p>
                </section>

                <!-- Workflow Section -->
                <section id="detail-workflow-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Workflow</h3>
                    <div id="detail-workflow" class="detail-workflow"></div>
                </section>

                <!-- Blockers Section -->
                <section id="detail-blockers-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Blocked By</h3>
                    <ul id="detail-blockers" class="detail-blockers"></ul>
                </section>

                <!-- Notes Section -->
                <section id="detail-notes-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Notes</h3>
                    <div id="detail-notes" class="detail-notes"></div>
                </section>

                <!-- Add Note Section -->
                <section class="detail-section">
                    <h3 class="detail-section-title">Add Note</h3>
                    <div class="add-note-form">
                        <textarea id="note-input" class="note-textarea" rows="3" placeholder="Add a note..."></textarea>
                        <button id="btn-add-note" class="action-btn action-btn-note" onclick="submitNote()">
                            Add Note
                        </button>
                    </div>
                </section>

                <!-- Closed Section -->
                <section id="detail-closed-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Closed</h3>
                    <div class="detail-fields">
                        <div class="detail-field">
                            <span class="detail-label">Closed At</span>
                            <span id="detail-closed-at" class="detail-value"></span>
                        </div>
                        <div class="detail-field" id="detail-closed-reason-field" style="display: none;">
                            <span class="detail-label">Reason</span>
                            <span id="detail-closed-reason" class="detail-value"></span>
                        </div>
                    </div>
                </section>

                <!-- Actions Section (for ticks awaiting human) -->
                <section id="detail-actions-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Actions</h3>
                    <div class="detail-actions">
                        <button id="btn-approve" class="action-btn action-btn-approve" onclick="approveTick()">
                            ✓ Approve
                        </button>
                        <button id="btn-reject" class="action-btn action-btn-reject" onclick="openRejectModal()">
                            ✗ Reject
                        </button>
                    </div>
                </section>

                <!-- Close Tick Section (for closable ticks) -->
                <section id="detail-close-section" class="detail-section" style="display: none;">
                    <h3 class="detail-section-title">Close Tick</h3>
                    <div class="detail-actions">
                        <button id="btn-close-tick" class="action-btn action-btn-close" onclick="openCloseModal()">
                            Close Tick
                        </button>
                    </div>
                </section>
            </div>
        </aside>

        <!-- Reject Feedback Modal -->
        <div id="reject-modal" class="modal-overlay hidden" onclick="closeRejectModal(event)">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3>Reject Tick</h3>
                    <button class="modal-close" onclick="closeRejectModal()" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <label for="reject-feedback" class="modal-label">Feedback (required)</label>
                    <textarea id="reject-feedback" class="modal-textarea" rows="4" placeholder="Explain why this is being rejected and what needs to change..."></textarea>
                </div>
                <div class="modal-footer">
                    <button class="action-btn action-btn-secondary" onclick="closeRejectModal()">Cancel</button>
                    <button class="action-btn action-btn-reject" onclick="submitReject()">Reject</button>
                </div>
            </div>
        </div>

        <!-- Close Tick Modal -->
        <div id="close-modal" class="modal-overlay hidden" onclick="closeCloseModal(event)">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3>Close Tick</h3>
                    <button class="modal-close" onclick="closeCloseModal()" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <label for="close-reason" class="modal-label">Reason (optional)</label>
                    <textarea id="close-reason" class="modal-textarea" rows="3" placeholder="Add an optional reason for closing..."></textarea>
                </div>
                <div class="modal-footer">
                    <button class="action-btn action-btn-secondary" onclick="closeCloseModal()">Cancel</button>
                    <button class="action-btn action-btn-close" onclick="submitClose()">Close Tick</button>
                </div>
            </div>
        </div>

        <!-- Create Tick Modal -->
        <div id="create-modal" class="modal-overlay hidden" onclick="closeCreateModal(event)">
            <div class="modal modal-lg" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3>Create Tick</h3>
                    <button class="modal-close" onclick="closeCreateModal()" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="create-form" onsubmit="submitCreateTick(event)">
                        <div class="form-group">
                            <label for="create-title" class="form-label">Title *</label>
                            <input type="text" id="create-title" class="form-input" placeholder="Enter tick title" required>
                        </div>
                        <div class="form-group">
                            <label for="create-description" class="form-label">Description</label>
                            <textarea id="create-description" class="form-textarea" rows="3" placeholder="Optional description"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="create-type" class="form-label">Type</label>
                                <select id="create-type" class="form-select">
                                    <option value="task">Task</option>
                                    <option value="epic">Epic</option>
                                    <option value="bug">Bug</option>
                                    <option value="feature">Feature</option>
                                    <option value="chore">Chore</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="create-priority" class="form-label">Priority</label>
                                <select id="create-priority" class="form-select">
                                    <option value="0">P0 - Critical</option>
                                    <option value="1">P1 - High</option>
                                    <option value="2" selected>P2 - Medium</option>
                                    <option value="3">P3 - Low</option>
                                    <option value="4">P4 - Backlog</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="create-parent" class="form-label">Parent Epic</label>
                                <select id="create-parent" class="form-select">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="create-requires" class="form-label">Workflow</label>
                                <select id="create-requires" class="form-select">
                                    <option value="">None</option>
                                    <option value="approval">Requires Approval</option>
                                    <option value="review">Requires Code Review</option>
                                    <option value="content">Requires Content Review</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="action-btn action-btn-secondary" onclick="closeCreateModal()">Cancel</button>
                    <button class="action-btn action-btn-primary" onclick="submitCreateTick(event)">Create</button>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Help Modal -->
        <div id="help-modal" class="modal-overlay hidden" onclick="closeHelpModal(event)">
            <div class="modal modal-help" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3>Keyboard Shortcuts</h3>
                    <button class="modal-close" onclick="closeHelpModal()" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-section">
                        <h4>Navigation</h4>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>↑</kbd> <kbd>↓</kbd> <kbd>←</kbd> <kbd>→</kbd></span>
                            <span class="shortcut-desc">Move between cards</span>
                        </div>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>j</kbd> <kbd>k</kbd> <kbd>h</kbd> <kbd>l</kbd></span>
                            <span class="shortcut-desc">Vim-style navigation</span>
                        </div>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>Enter</kbd></span>
                            <span class="shortcut-desc">Open selected card</span>
                        </div>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>Esc</kbd></span>
                            <span class="shortcut-desc">Close panel / Clear selection</span>
                        </div>
                    </div>
                    <div class="shortcuts-section">
                        <h4>Actions</h4>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>n</kbd></span>
                            <span class="shortcut-desc">Create new tick</span>
                        </div>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>a</kbd></span>
                            <span class="shortcut-desc">Approve (when panel open)</span>
                        </div>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>r</kbd></span>
                            <span class="shortcut-desc">Reject (when panel open)</span>
                        </div>
                        <div class="shortcut-row">
                            <span class="shortcut-keys"><kbd>?</kbd></span>
                            <span class="shortcut-desc">Show this help</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"></div>
    </div>
    <script src="static/app.js"></script>
</body>
</html>
