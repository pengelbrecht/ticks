{
  "id": "12s",
  "title": "Phase 5: Tickboard Enhancement",
  "description": "Enhance tickboard to serve as the visual interface for monitoring agent runs. Add streaming output APIs, live file watching, and rich UI components for run status display.\n\n## Goals\n- Tickboard replaces ticker TUI as the visual interface for monitoring runs\n- Real-time streaming of agent output via SSE\n- Display tool activity, token metrics, and verification status\n\n## New APIs\n- GET /api/run-stream/\u003cepic-id\u003e — SSE endpoint for streaming agent output\n- GET /api/run-status/\u003cepic-id\u003e — Current run state (iteration, tokens, active tool, etc.)\n- GET /api/records/\u003ctick-id\u003e — Completed run record for a task\n\n## Engine Integration\n- Engine already writes to .tick/logs/records/\u003ctick-id\u003e.live.json during runs (Phase 4)\n- Tickboard server watches this file and relays updates via SSE\n- On run completion, .live.json is finalized to .json and broadcast\n\n## Browser UI Enhancements\n- Streaming output pane (live agent stdout/stderr)\n- Tool activity indicator (current tool, input preview, duration)\n- Token/cost metrics display (input, output, cache read, cache creation, cost)\n- Verification status display\n- Run history view for completed tasks (expandable RunRecord details)",
  "notes": "2026-01-20 15:54 - Completed [ptp]: Added /api/records/:tickId endpoint. Pattern used: strings.TrimPrefix for path parsing, runrecord.Store.Read() for data access, errors.Is() for ErrNotFound checking. The endpoint follows existing handler patterns in server.go. Tests added at end of server_test.go with ports 18801-18804.\n2026-01-20 15:59 - Completed [u5c]: Added /api/run-status/:epicId endpoint. Pattern used: strings.TrimPrefix for path parsing, query.LoadTicksParallel() to find epic/tasks, runrecord.Store.ReadLive() for live record access. Added ReadLive() method to runrecord/store.go. Tests added at end of server_test.go with ports 18805-18810. The endpoint checks .live.json files for all tasks under the epic to detect active runs.\n2026-01-20 16:04 - Completed [kxe]: Added /api/run-stream/:epicId SSE endpoint. Pattern used: separate fsnotify watcher for records directory, per-epic client channel management with mutex, debounced file change handling. Event types match spec: task-started, task-update, tool-activity, task-completed, epic-completed. Uses RunStreamEvent struct for typed SSE events. Tests added with ports 18811-18816.\n2026-01-20 16:08 - Completed [iyf]: Added LiveFileWatcher in watcher.go. Key patterns: fsnotify watcher monitors single directory, debounce with map[string]*time.Timer, known files map for Created vs Updated detection. Important: runrecord.NewStore() expects tickRoot (repo root), so need filepath.Dir() 3 times from recordsDir. Event types: Created (new .live.json), Updated (modifications), Finalized (rename to .json). Tests use temp directories with proper path structure /repo/.tick/logs/records/.\n2026-01-20 16:13 - Completed [vcc]: Added run-output-pane.ts component. Key patterns: imports ShowToastOptions from tick-toast-stack.ts (don't redeclare Window interface), uses unsafeHTML for ANSI-to-HTML rendering, EventSource for SSE. SSE events: connected, task-started, task-update, tool-activity, task-completed, epic-completed. Output delta computed by comparing current output length with lastOutput. Component has all required features: epicId prop, autoScroll toggle, ANSI colors (Catppuccin), timestamps, clear/copy buttons, connection status.\n2026-01-20 16:16 - Completed [1f1]: Added tool-activity.ts component. Key patterns: ToolActivityInfo interface with name/input/output/startedAt/durationMs/isError/isComplete fields. TOOL_ICONS and TOOL_COLORS record mappings for Claude tools. Two display modes: compact (inline badge) and expanded (full panel with input/output sections). Live timer uses setInterval at 100ms, stops when isComplete is true. Component uses --tool-color CSS variable for dynamic coloring based on tool name.\n2026-01-20 16:20 - Completed [zxy]: Added run-metrics.ts component. Key patterns: MetricsRecord interface matches server (inputTokens, outputTokens, cacheReadTokens, cacheCreationTokens, costUsd, durationMs). Component has compact (inline) and expanded (panel) views. Token distribution bar uses colored segments for each token type. formatTokenCount() uses K/M suffixes for large values. Also fixed main.ts to import run-output-pane, tool-activity, run-metrics components, plus added sl-spinner and sl-icon-button Shoelace components that the streaming components use.\n2026-01-20 16:24 - Completed [wyk]: Added run history view to tick-detail-drawer. Key patterns: fetchRecord() returns null on 404 (not error), loadRunRecord() called in updated() when tick changes and is task type, expandedSections Set tracks collapsible UI state, TypeScript interfaces match Go JSON tags exactly (snake_case). Run history only shows for task type ticks. Copy log path uses navigator.clipboard API and window.showToast for feedback.\n2026-01-20 16:33 - Completed [2wq]: Added verification status display. Key patterns: 1) VerificationRecord/VerifierResult types in agent/stream.go match JSON snake_case naming, 2) Engine updates RunRecord with verification results after verification runs using GetRunRecord/SetRunRecord pattern, 3) Server computes verificationStatus by reading run records for closed tasks using runrecord.NewStore(), 4) UI shows verification badge on tick-card and expandable verification section in drawer. The verification field is only populated after task verification runs (requires verification to be enabled in ticker).",
  "status": "open",
  "priority": 2,
  "type": "epic",
  "owner": "peter@engelbrecht.dk",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-20T14:35:57.501376Z",
  "updated_at": "2026-01-20T15:33:56.588696Z"
}