{
  "id": "ntp",
  "title": "Phase 4: Run Log Storage",
  "description": "Move RunRecords from tick JSON files to separate .tick/runlog/\u003ctick-id\u003e.json files. Implement in-progress .live.json files and garbage collection.",
  "notes": "2026-01-18 13:41 - Session paused. New unified logging structure decided: all logs under .tick/logs/ with subdirs runs/, records/, checkpoints/, context/. Plan doc updated. runrecord package created but needs path update to .tick/logs/records/. Next: update all packages to use new paths, update tk init for .gitignore, create gc package.\n2026-01-20 13:49 - Task 63o complete: ticks.Client now uses runrecord.Store for SetRunRecord/GetRunRecord. Records stored at .tick/logs/records/\u003cid\u003e.json. The runrecord package was already created by previous tasks - this task just wired it into the Client. Note: the old 'run' field in tick JSONs may need migration or can be ignored (fallback read from old location not implemented).\n2026-01-20 13:54 - Task trw complete: Created tk migrate command that migrates run records from tick JSON 'run' field to .tick/logs/records/\u003cid\u003e.json. Successfully migrated 101 run records. The migration is idempotent and includes --dry-run support. The 'run' field is now removed from all tick JSON files.\n2026-01-20 13:58 - Task 3v4 complete: Created internal/gc package. API: gc.NewCleaner(tickRoot).WithMaxAge(duration).WithDryRun(bool).Cleanup() returns *Result with FilesDeleted, BytesFreed, EntriesTrimmed. Convenience function: gc.Cleanup(tickRoot, maxAge). Package cleans 4 log directories and trims activity.jsonl. Ready for integration into tk gc command and async cleanup in tk run/tk board.\n2026-01-20 14:02 - Task rar complete: Added tk gc command with --dry-run and --max-age flags. The command is registered in main.go's switch statement and uses gc.NewCleaner from internal/gc. Helper functions parseDuration (supports d/w/m units) and formatBytes are in gc.go. Flag reset added to root.go.\n2026-01-20 14:04 - Task 2dk complete: Added async gc.Cleanup to tk board startup (runs in goroutine with 30-day max age, logs errors to stderr). Note: tk run command doesn't exist yet (planned for Phase 6), so gc.Cleanup should be added to tk run when that command is implemented.\n2026-01-20 14:07 - Task lwo complete: Engine StateCallback now writes .live.json via runrecord.Store.WriteLive(). On iteration completion, FinalizeLive() renames to .json. LiveRecord type captures in-progress state including ActiveTool. Engine needs SetRunRecordStore() called to enable live tracking. Integration point for tickboard: watch .tick/logs/records/ for changes.\n2026-01-20 14:11 - Verification task 1si complete. Phase 4 core functionality verified working: runrecord store (read/write/live files), migration command, gc command, async gc in board startup. All related tests pass. Note: 4 test failures exist in tickboard/server and cloud packages but are pre-existing and unrelated to Phase 4 (port conflicts, missing static files, config file detection). Remaining open tasks in epic are for path updates to logs/ structure and init .gitignore update.\n2026-01-20 14:13 - Task kp2 complete: Updated internal/runlog to use .tick/logs/runs/ path. Files modified: internal/runlog/runlog.go (New, NewWithWorkDir), internal/runlog/runlog_test.go, and internal/engine/engine.go (comment only). All runlog tests pass.\n2026-01-20 14:15 - Task xu6 complete: Updated internal/checkpoint to use .tick/logs/checkpoints/ path. Modified NewManager() default and updated test assertion. The git verifier already excludes both .tick/ and .ticker/ paths, so filtering works correctly with the new location.\n2026-01-20 14:17 - Task 9v7 complete: Updated internal/context to use .tick/logs/context/ path. Modified NewStore() default, Store struct comment, store_test.go assertion, and prompt.go comment. All four log directories are now under .tick/logs/: runs/, records/, checkpoints/, context/. The Phase 4 path migrations are complete.\n2026-01-20 14:18 - Task cin complete: Updated tk init to add logs/ to .tick/.gitignore (line 59 in cmd/tk/cmd/init.go). New repos will now gitignore .tick/logs/ by default. Existing repos that ran tk init before this change may need to manually add logs/ to their .tick/.gitignore.",
  "status": "closed",
  "priority": 2,
  "type": "epic",
  "owner": "peter@engelbrecht.dk",
  "created_by": "peter@engelbrecht.dk",
  "created_at": "2026-01-18T07:26:04.307733Z",
  "updated_at": "2026-01-20T13:18:35.008154Z",
  "closed_at": "2026-01-20T13:18:35.008154Z",
  "closed_reason": "all tasks completed"
}